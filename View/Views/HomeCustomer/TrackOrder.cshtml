@using Data.Models
@using View.Utilities.Extensions
@model View.ViewModels.OrderVM
@using System.ComponentModel.DataAnnotations

@{
    ViewData["Title"] = "Track Your Orders";
    Layout = "_LayoutCustomer";

    // Lấy danh sách các trạng thái đơn hàng từ enum OrderStatus
    var orderStatuses = Enum.GetValues(typeof(OrderStatus)).Cast<OrderStatus>().ToList();

    // Danh sách các trạng thái chính
    var mainStatuses = new[] {
        OrderStatus.ChoXacNhan,
        OrderStatus.ChuanBiDonHang,
        OrderStatus.DangGiaoHang,
        OrderStatus.DaGiaoHang,
        OrderStatus.HoanThanh,
        OrderStatus.DaHuy
    };
}

<div class="container mt-5">
    <h2 class="text-center mb-4">Track Your Orders</h2>

    <!-- Nav Bar for Order Status -->
    <ul class="nav nav-tabs" id="orderTabs">
        @foreach (var status in mainStatuses)
        {
            <li class="nav-item" role="presentation">
                <a class="nav-link @((status == OrderStatus.ChoXacNhan) ? "active" : "")" id="status-@status-tab" data-bs-toggle="tab" href="#status-@status" role="tab" aria-controls="status-@status" aria-selected="@(status == OrderStatus.ChoXacNhan ? "true" : "false")">
                    @status
                </a>
            </li>
        }
    </ul>

    <div class="tab-content mt-3" id="orderTabsContent" style="max-height:500px">
        @foreach (var status in mainStatuses)
        {
            var ordersInStatus = Model.OrdersByStatus.ContainsKey(status) ? Model.OrdersByStatus[status] : new List<Order>();

            <div class="tab-pane fade @((status == OrderStatus.ChoXacNhan && ordersInStatus.Any()) ? "show active" : "")" id="status-@status" role="tabpanel" aria-labelledby="status-@status-tab">
                @if (ordersInStatus.Any())
                {
                    <div class="d-flex flex-wrap gap-3 justify-content-start">
                        @foreach (var order in ordersInStatus)
                        {
                            <div class="order-card card shadow-sm" style="width: 300px; margin-bottom: 15px;">
                                <div class="card-body">
                                    <strong>Order ID:</strong> @order.Id <br />
                                    <strong>Order Date:</strong> @order.DayCreate.ToString("dd/MM/yyyy") <br />
                                    <strong>Total:</strong> @order.Price.ToString("#,0 VND", new System.Globalization.CultureInfo("vi-VN"))
                                    <div class="d-flex gap-2 mt-3">
                                        <button class="btn btn-info btn-sm" onclick="viewOrderDetails(@order.Id)">View Details</button>
                                        @if (order.Status == OrderStatus.ChoXacNhan || order.Status == OrderStatus.ChuanBiDonHang)
                                        {
                                            <button class="btn btn-danger btn-sm" onclick="cancelOrder(@order.Id)">Cancel Order</button>
                                        }
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                }
                else
                {
                    <!-- Hiển thị hình ảnh và thông báo "No orders found for this status" -->
                    <div class="text-center">
                        <img src="/path/404.png" alt="No Orders" class="img-fluid" style="max-width: 200px;" />
                        <p class="mt-3">No orders found for this status.</p>
                    </div>
                }
            </div>
        }
    </div>
</div>

<style>
    .d-flex .btn {
        margin-right: 10px; /* Thêm khoảng cách giữa các nút */
    }
    .order-card {
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 15px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        margin-bottom: 15px;
    }

    .container {
        max-width: 1200px;
    }
</style>

@section Scripts {
    <script>
        // Khởi tạo Bootstrap tab chuyển đổi (nếu chưa tự động chạy)
        var myTab = new bootstrap.Tab(document.querySelector('.nav-tabs .active'));
        myTab.show();
    </script>
}
